<div class="fixed-footer" [class.visible]="editingArticleId" *ngIf="authService.user$ | async">
    <div class="footer-header" (click)="editingArticleId ? cancelEdit() : null">
        {{ editingArticleId ? 'Modifier l\'article' : 'Ajouter un nouveau article' }}
    </div>

    <div class="footer-form">
        <input type="text" [(ngModel)]="newArticleTitle" placeholder="Titre" class="footer-input title-input">
        <input type="text" [(ngModel)]="newArticleTags" placeholder="Tags" class="footer-input content-input">
        <input type="text" [(ngModel)]="newArticleImage" placeholder="Image, https..."
            class="footer-input content-input">
        <textarea class="form-control" [(ngModel)]="newArticleContent" rows="15" placeholder="Contenu"></textarea>

        <button (click)="createArticle()" class="send-btn">
            {{ editingArticleId ? 'Mettre à jour' : 'Publier' }}
        </button>
        <button *ngIf="editingArticleId" (click)="cancelEdit()" class="cancel-btn"
            style="background: #666; margin-left: 10px; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 25px; font-weight: 600; cursor: pointer;">Cancel</button>
    </div>
</div>

<div class="feed-container fade-in">
    <div class="feed-list">
        <ng-container *ngIf="articles$ | async as articles; else loading">
            <div *ngFor="let article of articles; trackBy: trackByArticleId" class="feed-card">
                <!-- Article Header -->
                <div class="card-header">
                    <div class="author-info">
                        <span class="author-name">{{ article.author.username }}</span>
                        <span class="post-date">{{ article.createdAt | date:'mediumDate' }}</span>
                    </div>
                    <div class="card-actions">
                        <button *ngIf="canEditArticle(article)" (click)="editArticle(article)" class="btn-icon">
                            <i class="fas fa-edit"></i> Modifier
                        </button>
                        <button *ngIf="canDeleteArticle(article)" (click)="deleteArticle(article._id, $event)"
                            class="btn-icon">
                            <i class="fas fa-trash"></i> Supprimer
                        </button>
                    </div>
                </div>

                <!-- Article Content -->
                <div class="card-content">
                    <h2 class="article-title">{{ article.title }}</h2>
                    <p class="article-text">{{ article.content }}</p>
                    <div class="article-image" *ngIf="article.image">
                        <img [src]="article.image" alt="Article Image">
                    </div>
                    <div class="tags">
                        <span *ngFor="let tag of article.tags" class="tag">#{{ tag }}</span>
                    </div>
                </div>

                <!-- Comments Section -->
                <div class="comments-section">
                    <div class="comments-list">
                        <div *ngFor="let comment of article.comments" class="comment-item">
                            <div class="comment-header">
                                <span class="comment-author">{{ comment.user.username }}</span>
                                <span class="comment-date">{{ comment.createdAt | date:'shortTime' }}</span>
                                <button *ngIf="canDeleteComment(comment)" (click)="deleteComment(comment._id)"
                                    class="delete-comment-btn">×</button>
                            </div>
                            <p class="comment-text">{{ comment.content }}</p>
                        </div>
                    </div>

                    <!-- Add Comment Input -->
                    <div class="comment-input-wrapper" *ngIf="authService.user$ | async">
                        <input type="text" [(ngModel)]="newCommentContent[article._id]"
                            (keyup.enter)="addComment(article._id)" placeholder="Ecrire un commentaire..."
                            class="comment-input-field">
                        <button (click)="addComment(article._id)" class="post-btn-inside">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </ng-container>
        <ng-template #loading>
            <div class="loading">Chargement...</div>
        </ng-template>
    </div>
</div>